<!DOCTYPE html>
<html>
<head>
    <title>Todoアプリ タイトル変更</title>
    <style src="todo-style.css"></style>
</head>
<body onload="init()">
    <h1>ToDoリスト</h1>
    <input id="todo-input" onkeypress="handleKey(event)">
    <button onclick="addTodo()">追加</button>
    <button onclick="cleanAll()">全削除</button>

    <ul id="todo-list"></ul>

    <button onclick="setFiler('all')">すべて</button>
    <button onclick="setFiler('active')">未完了</button>
    <button onclick="setFiler('completed')">完了</button>

    <p id="count"></p>
    
    <script>
        let todos = [];

        let filterMode = "all";

        loadTodos();

        displayTodos();

        function loadTodos(){
            const data = localStorage.getItem("todos");
            if(data){
                todos = JSON.parse(data);
            }
        }

        function addTodo(){
            const input = document.getElementById("todo-input");
            const text = input.value.trim();
            if(text === ""){
                return;
            }
            todos.push({
                text: text, completed: false
            });
            input.value = "";
            saveTodos();
            displayTodos();
        }

        function setFiler(mode){
            filterMode = mode;
            displayTodos();
        }

        function displayTodos(){
            const list = document.getElementById("todo-list");
            let html = "";
            let filteredTodos = todos;
            if(filterMode === "active"){
                filteredTodos = todos.filter(todo => !todo.completed);
            }
            if(filterMode === "completed"){
                filteredTodos = todos.filter(todo => todo.completed);
            }
            for(let i = 0; i < filteredTodos.length; i++){
                let checked = "";
                let style = "";
                if(filteredTodos[i].completed){
                    checked = "checked"
                    style = "style='text-decoration: line-through;'"
                }
                html += "<li " + style + ">" 
                    + "<input type='checkbox' " 
                    + checked 
                    + " onclick='toggleTodo(" + i + ")'>"
                    + filteredTodos[i].text
                    + "<button onclick='deleteTodo(" + i + ")'>削除</button>"
                    + "<button onclick='editTodo(" + i + ")'>編集</button>"
                    + "</li>"
            }
            list.innerHTML = html;

            document.getElementById("count").textContent =
             "未完了: " + todos.filter(todo => !todo.completed).length;
        }

        function deleteTodo(index){
            if(confirm("削除しますか？")){
                todos.splice(index, 1);
                saveTodos();
                displayTodos();
            }
        }

        function editTodo(index){
            const newText = prompt("編集内容を入力", todos[index].text);
            if(newText !== null){
                todos[index].text = newText.trim();
                saveTodos();
                displayTodos();
            }
        }

        function saveTodos(){
            localStorage.setItem("todos", JSON.stringify(todos));
        }

        function toggleTodo(index){
            todos[index].completed = !todos[index].completed;
            saveTodos();
            displayTodos();
        }

        function handleKey(event){
            if(event.key === "Enter"){
                addTodo();
            }
        }

        function init(){
            loadTodos();
            displayTodos();
        }

        function cleanAll(){
            if(confirm("すべて削除しますか？")){
                todos = [];
                saveTodos();
                displayTodos();
            }
        }
    </script>
</body>
</html>